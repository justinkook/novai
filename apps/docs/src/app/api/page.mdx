# API Reference

The NovAI API provides comprehensive endpoints for managing games, AI agents, and data sources. This documentation covers all available endpoints, request/response formats, and authentication.

## Base URL

```
Development: http://localhost:3001
Production: https://api.novai.com
```

## Authentication

All API requests require authentication using JWT tokens.

### Getting a Token

```bash
POST /auth/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123"
}
```

Response:
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": "user-id",
    "email": "user@example.com",
    "name": "John Doe"
  }
}
```

### Using the Token

Include the token in the Authorization header:

```bash
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

## Game Engine API

### Start a New Game

```bash
POST /games
Content-Type: application/json

{
  "campaignId": "baldurs-gate-3",
  "playerName": "Adventurer",
  "characterClass": "fighter",
  "difficulty": "normal"
}
```

Response:
```json
{
  "gameId": "game-123",
  "state": {
    "player": {
      "name": "Adventurer",
      "class": "fighter",
      "level": 1,
      "health": 12,
      "inventory": []
    },
    "location": {
      "name": "Nautiloid",
      "description": "You find yourself on a mind flayer ship..."
    },
    "availableActions": ["move", "examine", "talk"]
  }
}
```

### Get Game State

```bash
GET /games/{gameId}
Authorization: Bearer {token}
```

Response:
```json
{
  "gameId": "game-123",
  "state": {
    "player": { /* player state */ },
    "location": { /* location state */ },
    "npcs": [ /* NPCs in current location */ ],
    "inventory": [ /* player inventory */ ],
    "quests": [ /* active quests */ ]
  },
  "history": [
    {
      "timestamp": "2024-01-15T10:30:00Z",
      "action": "move",
      "description": "You walk to the tavern..."
    }
  ]
}
```

### Perform Action

```bash
POST /games/{gameId}/actions
Content-Type: application/json

{
  "type": "move",
  "target": "tavern",
  "parameters": {
    "method": "walk"
  }
}
```

Response:
```json
{
  "success": true,
  "newState": {
    "location": {
      "name": "Tavern",
      "description": "The tavern is bustling with activity..."
    }
  },
  "aiResponse": "You enter the tavern. The air is thick with the smell of ale and wood smoke...",
  "availableActions": ["talk", "examine", "buy", "rest"]
}
```

### Get Available Actions

```bash
GET /games/{gameId}/actions
Authorization: Bearer {token}
```

Response:
```json
{
  "actions": [
    {
      "type": "move",
      "targets": ["tavern", "shop", "guild"],
      "description": "Move to a new location"
    },
    {
      "type": "talk",
      "targets": ["innkeeper", "merchant", "patron"],
      "description": "Talk to an NPC"
    },
    {
      "type": "examine",
      "targets": ["bar", "fireplace", "notice_board"],
      "description": "Examine an object"
    }
  ]
}
```

## AI Agent API

### Configure AI Agent

```bash
POST /ai-agent/configure
Content-Type: application/json

{
  "gameId": "game-123",
  "configuration": {
    "provider": "openai",
    "model": "gpt-4-turbo",
    "temperature": 0.7,
    "personality": {
      "type": "narrative-focused",
      "style": "immersive and descriptive"
    },
    "memory": {
      "type": "conversation",
      "maxLength": 10
    }
  }
}
```

Response:
```json
{
  "success": true,
  "agentId": "agent-456",
  "configuration": {
    /* applied configuration */
  }
}
```

### Get AI Response

```bash
POST /ai-agent/{agentId}/respond
Content-Type: application/json

{
  "action": {
    "type": "talk",
    "target": "innkeeper",
    "message": "Hello, I'm looking for work."
  },
  "context": {
    "currentState": { /* game state */ },
    "recentHistory": [ /* recent actions */ ]
  }
}
```

Response:
```json
{
  "response": "The innkeeper looks you up and down with a practiced eye...",
  "suggestedActions": [
    {
      "type": "ask",
      "target": "innkeeper",
      "description": "Ask about available work"
    },
    {
      "type": "buy",
      "target": "ale",
      "description": "Buy a drink"
    }
  ],
  "metadata": {
    "tokensUsed": 150,
    "responseTime": 1200,
    "confidence": 0.85
  }
}
```

### Update AI Memory

```bash
POST /ai-agent/{agentId}/memory
Content-Type: application/json

{
  "type": "add",
  "memory": {
    "type": "conversation",
    "content": "Player helped the innkeeper with a problem",
    "importance": "high",
    "timestamp": "2024-01-15T10:30:00Z"
  }
}
```

## Data Sources API

### Upload Data Source

```bash
POST /data-sources
Content-Type: multipart/form-data

{
  "name": "Baldur's Gate Lore",
  "type": "markdown",
  "file": <file>,
  "tags": ["lore", "setting", "characters"],
  "campaignId": "baldurs-gate-3"
}
```

Response:
```json
{
  "id": "ds-789",
  "name": "Baldur's Gate Lore",
  "status": "processing",
  "processedChunks": 0,
  "totalChunks": 0
}
```

### Get Data Source Status

```bash
GET /data-sources/{dataSourceId}
Authorization: Bearer {token}
```

Response:
```json
{
  "id": "ds-789",
  "name": "Baldur's Gate Lore",
  "status": "completed",
  "processedChunks": 45,
  "totalChunks": 45,
  "size": "2.3MB",
  "createdAt": "2024-01-15T10:00:00Z",
  "updatedAt": "2024-01-15T10:05:00Z"
}
```

### Search Data Sources

```bash
POST /data-sources/search
Content-Type: application/json

{
  "query": "Baldur's Gate history",
  "filters": {
    "campaignId": "baldurs-gate-3",
    "tags": ["lore", "history"]
  },
  "limit": 10
}
```

Response:
```json
{
  "results": [
    {
      "id": "chunk-123",
      "content": "The city of Baldur's Gate was founded...",
      "source": "ds-789",
      "relevance": 0.95,
      "metadata": {
        "tags": ["lore", "history"],
        "section": "City History"
      }
    }
  ],
  "total": 15,
  "query": "Baldur's Gate history"
}
```

### Delete Data Source

```bash
DELETE /data-sources/{dataSourceId}
Authorization: Bearer {token}
```

Response:
```json
{
  "success": true,
  "message": "Data source deleted successfully"
}
```

## Campaign Management API

### List Campaigns

```bash
GET /campaigns
Authorization: Bearer {token}
```

Response:
```json
{
  "campaigns": [
    {
      "id": "baldurs-gate-3",
      "name": "Baldur's Gate 3",
      "description": "An epic adventure in the Forgotten Realms",
      "ruleset": "dnd-5e",
      "dataSources": 5,
      "activeGames": 3,
      "createdAt": "2024-01-01T00:00:00Z"
    }
  ]
}
```

### Get Campaign Details

```bash
GET /campaigns/{campaignId}
Authorization: Bearer {token}
```

Response:
```json
{
  "id": "baldurs-gate-3",
  "name": "Baldur's Gate 3",
  "description": "An epic adventure in the Forgotten Realms",
  "ruleset": "dnd-5e",
  "dataSources": [
    {
      "id": "ds-789",
      "name": "Baldur's Gate Lore",
      "status": "completed"
    }
  ],
  "aiAgent": {
    "provider": "openai",
    "model": "gpt-4-turbo",
    "personality": "experienced DM"
  },
  "world": {
    "name": "Forgotten Realms",
    "description": "A rich fantasy world..."
  }
}
```

### Create Campaign

```bash
POST /campaigns
Content-Type: application/json

{
  "name": "Custom Campaign",
  "description": "A custom RPG campaign",
  "ruleset": "dnd-5e",
  "aiAgent": {
    "provider": "openai",
    "model": "gpt-4-turbo",
    "personality": "narrative-focused"
  },
  "dataSources": ["ds-123", "ds-456"]
}
```

## User Management API

### Get User Profile

```bash
GET /users/profile
Authorization: Bearer {token}
```

Response:
```json
{
  "id": "user-123",
  "email": "user@example.com",
  "name": "John Doe",
  "preferences": {
    "defaultDifficulty": "normal",
    "preferredRuleset": "dnd-5e",
    "aiPersonality": "narrative-focused"
  },
  "statistics": {
    "gamesPlayed": 15,
    "totalPlayTime": "45h 30m",
    "campaignsCreated": 3
  }
}
```

### Update User Profile

```bash
PATCH /users/profile
Content-Type: application/json

{
  "name": "John Smith",
  "preferences": {
    "defaultDifficulty": "hard",
    "preferredRuleset": "pathfinder"
  }
}
```

### Get User Games

```bash
GET /users/games
Authorization: Bearer {token}
```

Response:
```json
{
  "games": [
    {
      "id": "game-123",
      "campaignId": "baldurs-gate-3",
      "status": "active",
      "createdAt": "2024-01-15T10:00:00Z",
      "lastPlayed": "2024-01-15T11:30:00Z",
      "playTime": "1h 30m"
    }
  ]
}
```

## Error Handling

### Error Response Format

```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid action type",
    "details": {
      "field": "action.type",
      "value": "invalid_action",
      "allowed": ["move", "talk", "examine"]
    }
  }
}
```

### Common Error Codes

- `AUTHENTICATION_ERROR` - Invalid or missing token
- `AUTHORIZATION_ERROR` - Insufficient permissions
- `VALIDATION_ERROR` - Invalid request data
- `NOT_FOUND` - Resource not found
- `RATE_LIMIT_EXCEEDED` - Too many requests
- `INTERNAL_ERROR` - Server error

### Rate Limiting

API requests are rate-limited:

- **Authentication endpoints**: 10 requests per minute
- **Game actions**: 60 requests per minute
- **Data source operations**: 30 requests per minute
- **General endpoints**: 100 requests per minute

## WebSocket API

### Game Events

Connect to receive real-time game updates:

```javascript
const ws = new WebSocket('ws://localhost:3001/games/{gameId}/events');

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  
  switch (data.type) {
    case 'state_update':
      updateGameState(data.state);
      break;
    case 'ai_response':
      displayAIResponse(data.response);
      break;
    case 'action_result':
      handleActionResult(data.result);
      break;
  }
};
```

### Event Types

- `state_update` - Game state has changed
- `ai_response` - AI agent has responded
- `action_result` - Action has been processed
- `error` - An error has occurred

## SDKs and Libraries

### JavaScript/TypeScript SDK

```bash
npm install @novai/sdk
```

```typescript
import { NovAIClient } from '@novai/sdk';

const client = new NovAIClient({
  baseUrl: 'http://localhost:3001',
  token: 'your-jwt-token'
});

// Start a new game
const game = await client.games.create({
  campaignId: 'baldurs-gate-3',
  playerName: 'Adventurer'
});

// Perform an action
const result = await client.games.performAction(game.id, {
  type: 'move',
  target: 'tavern'
});
```

### Python SDK

```bash
pip install novai-sdk
```

```python
from novai import NovAIClient

client = NovAIClient(
    base_url="http://localhost:3001",
    token="your-jwt-token"
)

# Start a new game
game = client.games.create(
    campaign_id="baldurs-gate-3",
    player_name="Adventurer"
)

# Perform an action
result = client.games.perform_action(
    game_id=game.id,
    action={
        "type": "move",
        "target": "tavern"
    }
)
```

## Testing

### Test Environment

Use the test environment for development:

```
Base URL: http://localhost:3001
Test Token: test-token-123
```

### Example Requests

```bash
# Start a test game
curl -X POST http://localhost:3001/games \
  -H "Authorization: Bearer test-token-123" \
  -H "Content-Type: application/json" \
  -d '{
    "campaignId": "test-campaign",
    "playerName": "TestPlayer"
  }'

# Perform an action
curl -X POST http://localhost:3001/games/game-123/actions \
  -H "Authorization: Bearer test-token-123" \
  -H "Content-Type: application/json" \
  -d '{
    "type": "move",
    "target": "tavern"
  }'
```

## Support

- **Documentation**: This site contains comprehensive guides
- **API Status**: Check status at https://status.novai.com
- **Support**: Contact support@novai.com
- **GitHub**: Report issues at https://github.com/novai/api 