---
title: "@novai/rulesets"
description: "Game ruleset definitions and management for NovAI game engine"
---

# @novai/rulesets

The rulesets package provides a flexible system for defining and managing game rules, mechanics, and systems. This package includes pre-built rulesets for popular tabletop RPGs and tools for creating custom rulesets.

## Installation

```bash
npm install @novai/rulesets
# or
pnpm add @novai/rulesets
```

## Quick Start

```typescript
import { RulesetManager, DND5eRuleset } from '@novai/rulesets';

// Use pre-built D&D 5e ruleset
const dndRuleset = new DND5eRuleset();

// Get stat check rules
const statCheck = dndRuleset.getStatCheck('strength', 15);
console.log(`Roll d20 + ${statCheck.modifier} vs DC ${statCheck.difficulty}`);

// Create a custom ruleset
const customRuleset = new Ruleset({
  name: 'custom-fantasy',
  stats: ['strength', 'agility', 'intelligence', 'charisma'],
  skills: {
    strength: ['athletics', 'intimidation'],
    agility: ['acrobatics', 'stealth', 'sleight_of_hand'],
    intelligence: ['arcana', 'history', 'investigation'],
    charisma: ['deception', 'insight', 'persuasion']
  }
});
```

## Core Components

### Ruleset

Base class for defining game rules and mechanics.

```typescript
export class Ruleset {
  constructor(config: RulesetConfig)
  
  getStatCheck(stat: string, difficulty: number): StatCheck
  getCombatRules(): CombatRules
  getSkillCheck(skill: string, difficulty: number): SkillCheck
  validateAction(action: string, context: GameContext): boolean
}
```

### DND5eRuleset

Pre-built ruleset for Dungeons & Dragons 5th Edition.

```typescript
export class DND5eRuleset extends Ruleset {
  getStatCheck(stat: string, difficulty: number): DNDStatCheck
  getCombatRules(): DNDCombatRules
  getSpellRules(): SpellRules
  getLevelingRules(): LevelingRules
}
```

### RulesetManager

Centralized management system for multiple rulesets.

```typescript
export class RulesetManager {
  constructor()
  
  registerRuleset(ruleset: Ruleset): void
  getRuleset(name: string): Ruleset | null
  listRulesets(): string[]
  validateRuleset(ruleset: Ruleset): ValidationResult
}
```

## Types

### Ruleset Configuration

```typescript
interface RulesetConfig {
  name: string;
  description: string;
  version: string;
  stats: string[];
  skills: Record<string, string[]>;
  combatRules: CombatRules;
  statCheckRules: StatCheckRules;
  levelingRules?: LevelingRules;
  spellRules?: SpellRules;
  equipmentRules?: EquipmentRules;
}

interface CombatRules {
  initiative: InitiativeRule;
  actions: ActionRule[];
  damage: DamageRule;
  conditions: ConditionRule[];
}

interface StatCheckRules {
  baseDie: number;
  modifierCalculation: (stat: number) => number;
  criticalSuccess?: number;
  criticalFailure?: number;
}
```

### Game Mechanics

```typescript
interface StatCheck {
  stat: string;
  difficulty: number;
  modifier: number;
  die: number;
  result?: number;
  success?: boolean;
}

interface SkillCheck {
  skill: string;
  difficulty: number;
  modifier: number;
  die: number;
  advantage?: boolean;
  disadvantage?: boolean;
}

interface CombatAction {
  name: string;
  type: 'attack' | 'spell' | 'ability' | 'item';
  range: number;
  damage?: DamageRoll;
  effects?: Effect[];
}
```

## Usage Examples

### Using Pre-built Rulesets

```typescript
import { DND5eRuleset } from '@novai/rulesets';

const dndRuleset = new DND5eRuleset();

// Get stat check for strength
const strengthCheck = dndRuleset.getStatCheck('strength', 15);
console.log(`Roll d20 + ${strengthCheck.modifier} vs DC 15`);

// Get combat rules
const combatRules = dndRuleset.getCombatRules();
console.log('Available actions:', combatRules.actions.map(a => a.name));

// Get spell rules
const spellRules = dndRuleset.getSpellRules();
console.log('Spell levels:', spellRules.levels);

// Get leveling rules
const levelingRules = dndRuleset.getLevelingRules();
console.log('XP for level 5:', levelingRules.getXPForLevel(5));
```

### Creating Custom Rulesets

```typescript
import { Ruleset, RulesetConfig } from '@novai/rulesets';

// Create a custom fantasy ruleset
const fantasyConfig: RulesetConfig = {
  name: 'custom-fantasy',
  description: 'A custom fantasy RPG ruleset',
  version: '1.0.0',
  stats: ['strength', 'agility', 'intelligence', 'charisma', 'wisdom'],
  skills: {
    strength: ['athletics', 'intimidation'],
    agility: ['acrobatics', 'stealth', 'sleight_of_hand'],
    intelligence: ['arcana', 'history', 'investigation', 'nature'],
    charisma: ['deception', 'insight', 'persuasion', 'performance'],
    wisdom: ['animal_handling', 'medicine', 'perception', 'survival']
  },
  combatRules: {
    initiative: {
      type: 'd20',
      modifier: 'agility'
    },
    actions: [
      {
        name: 'attack',
        type: 'attack',
        range: 5,
        damage: { die: 6, count: 1, modifier: 'strength' }
      },
      {
        name: 'cast_spell',
        type: 'spell',
        range: 60,
        damage: { die: 8, count: 2, modifier: 'intelligence' }
      }
    ],
    damage: {
      type: 'hp',
      deathThreshold: 0
    },
    conditions: [
      { name: 'prone', effects: ['disadvantage_on_attacks'] },
      { name: 'stunned', effects: ['cannot_take_actions'] }
    ]
  },
  statCheckRules: {
    baseDie: 20,
    modifierCalculation: (stat) => Math.floor((stat - 10) / 2),
    criticalSuccess: 20,
    criticalFailure: 1
  }
};

const fantasyRuleset = new Ruleset(fantasyConfig);

// Use the custom ruleset
const check = fantasyRuleset.getStatCheck('strength', 12);
console.log(`Roll d${check.die} + ${check.modifier} vs DC ${check.difficulty}`);
```

### Ruleset Management

```typescript
import { RulesetManager, Ruleset } from '@novai/rulesets';

const manager = new RulesetManager();

// Register pre-built rulesets
manager.registerRuleset(new DND5eRuleset());

// Register custom ruleset
const customRuleset = new Ruleset(customConfig);
manager.registerRuleset(customRuleset);

// Get a ruleset by name
const ruleset = manager.getRuleset('custom-fantasy');
if (ruleset) {
  const check = ruleset.getStatCheck('strength', 15);
  console.log('Stat check:', check);
}

// List all available rulesets
const rulesets = manager.listRulesets();
console.log('Available rulesets:', rulesets);
```

### Advanced Ruleset Features

```typescript
import { AdvancedRuleset, Condition, Effect } from '@novai/rulesets';

// Create an advanced ruleset with conditions and effects
const advancedConfig = {
  name: 'advanced-fantasy',
  // ... basic config
  conditions: [
    new Condition('poisoned', {
      effects: [
        new Effect('disadvantage_on_attacks'),
        new Effect('disadvantage_on_ability_checks')
      ],
      duration: 'until_saved'
    }),
    new Condition('blessed', {
      effects: [
        new Effect('advantage_on_attacks'),
        new Effect('bonus_d4_to_saves')
      ],
      duration: '1_minute'
    })
  ],
  spells: [
    {
      name: 'fireball',
      level: 3,
      school: 'evocation',
      castingTime: '1_action',
      range: 150,
      components: ['V', 'S', 'M'],
      duration: 'instantaneous',
      damage: { die: 8, count: 8, type: 'fire' }
    }
  ]
};

const advancedRuleset = new AdvancedRuleset(advancedConfig);

// Apply conditions to a character
const character = {
  name: 'Aragorn',
  stats: { strength: 16, dexterity: 14, constitution: 12 },
  conditions: []
};

// Apply poisoned condition
advancedRuleset.applyCondition(character, 'poisoned');
console.log('Character conditions:', character.conditions);

// Check if character has advantage on attacks
const hasAdvantage = advancedRuleset.hasAdvantage(character, 'attack');
console.log('Has advantage on attacks:', hasAdvantage);
```

## Pre-built Rulesets

### D&D 5e Ruleset

```typescript
import { DND5eRuleset } from '@novai/rulesets';

const dndRuleset = new DND5eRuleset();

// Core stats
const stats = dndRuleset.getStats();
console.log('D&D 5e stats:', stats); // ['strength', 'dexterity', 'constitution', 'intelligence', 'wisdom', 'charisma']

// Skills by ability
const skills = dndRuleset.getSkills();
console.log('Strength skills:', skills.strength); // ['athletics']

// Stat check with proficiency
const check = dndRuleset.getStatCheck('strength', 15, { proficiency: true });
console.log(`Roll d20 + ${check.modifier} + proficiency vs DC 15`);

// Combat actions
const actions = dndRuleset.getCombatActions();
console.log('Available actions:', actions.map(a => a.name));

// Spell casting
const spell = dndRuleset.getSpell('fireball');
console.log('Fireball damage:', spell.damage); // { die: 8, count: 8, type: 'fire' }
```

### Custom Sci-Fi Ruleset

```typescript
import { Ruleset } from '@novai/rulesets';

const scifiConfig: RulesetConfig = {
  name: 'cyberpunk-2077',
  description: 'Cyberpunk 2077 inspired ruleset',
  version: '1.0.0',
  stats: ['body', 'reflexes', 'technical', 'intelligence', 'cool', 'empathy'],
  skills: {
    body: ['athletics', 'brawling', 'endurance'],
    reflexes: ['acrobatics', 'driving', 'handgun', 'melee'],
    technical: ['crafting', 'demolitions', 'engineering'],
    intelligence: ['hacking', 'investigation', 'science'],
    cool: ['intimidation', 'stealth', 'streetwise'],
    empathy: ['animal_handling', 'human_perception', 'persuasion']
  },
  combatRules: {
    initiative: {
      type: 'd10',
      modifier: 'reflexes'
    },
    actions: [
      {
        name: 'quick_attack',
        type: 'attack',
        range: 5,
        damage: { die: 6, count: 1, modifier: 'body' }
      },
      {
        name: 'hack',
        type: 'ability',
        range: 30,
        effects: ['system_shock', 'weapon_disable']
      }
    ],
    damage: {
      type: 'hp',
      deathThreshold: -10
    }
  },
  statCheckRules: {
    baseDie: 10,
    modifierCalculation: (stat) => stat,
    criticalSuccess: 10,
    criticalFailure: 1
  }
};

const scifiRuleset = new Ruleset(scifiConfig);
```

## Advanced Features

### Conditional Rules

```typescript
import { ConditionalRuleset } from '@novai/rulesets';

const conditionalRuleset = new ConditionalRuleset({
  name: 'adaptive-fantasy',
  baseRuleset: fantasyRuleset,
  conditions: [
    {
      condition: (context) => context.location === 'underwater',
      rules: {
        movement: { multiplier: 0.5 },
        attacks: { disadvantage: true },
        spells: { verbal_components: false }
      }
    },
    {
      condition: (context) => context.timeOfDay === 'night',
      rules: {
        perception: { disadvantage: true },
        stealth: { advantage: true }
      }
    }
  ]
});

// Rules adapt based on context
const underwaterCheck = conditionalRuleset.getStatCheck('strength', 15, {
  location: 'underwater'
});
console.log('Underwater check:', underwaterCheck);
```

### Multi-class Support

```typescript
import { MultiClassRuleset } from '@novai/rulesets';

const multiClassRuleset = new MultiClassRuleset({
  name: 'multi-class-fantasy',
  baseRuleset: dndRuleset,
  classes: [
    {
      name: 'fighter',
      hitDie: 10,
      proficiencies: ['light_armor', 'medium_armor', 'heavy_armor', 'shields'],
      features: ['fighting_style', 'second_wind']
    },
    {
      name: 'wizard',
      hitDie: 6,
      proficiencies: ['daggers', 'quarterstaffs'],
      features: ['spellcasting', 'arcane_recovery']
    }
  ]
});

// Create a fighter/wizard character
const character = {
  name: 'Gandalf',
  classes: [
    { name: 'fighter', level: 2 },
    { name: 'wizard', level: 3 }
  ]
};

const totalLevel = multiClassRuleset.getTotalLevel(character);
const spellSlots = multiClassRuleset.getSpellSlots(character);
console.log('Total level:', totalLevel); // 5
console.log('Spell slots:', spellSlots);
```

### Equipment System

```typescript
import { EquipmentRuleset } from '@novai/rulesets';

const equipmentRuleset = new EquipmentRuleset({
  name: 'equipment-heavy-fantasy',
  baseRuleset: dndRuleset,
  equipment: {
    weapons: [
      {
        name: 'longsword',
        type: 'melee',
        damage: { die: 8, count: 1, type: 'slashing' },
        properties: ['versatile'],
        weight: 3,
        cost: 15
      }
    ],
    armor: [
      {
        name: 'chain_mail',
        type: 'heavy',
        ac: 16,
        disadvantage: true,
        weight: 55,
        cost: 75
      }
    ],
    items: [
      {
        name: 'healing_potion',
        type: 'consumable',
        effect: { healing: { die: 4, count: 2, modifier: 2 } },
        weight: 0.5,
        cost: 50
      }
    ]
  }
});

// Calculate equipment effects
const character = {
  equipment: ['longsword', 'chain_mail', 'healing_potion'],
  stats: { strength: 16, dexterity: 14 }
};

const ac = equipmentRuleset.calculateAC(character);
const encumbrance = equipmentRuleset.calculateEncumbrance(character);
console.log('Armor Class:', ac);
console.log('Encumbrance:', encumbrance);
```

## Performance Optimization

### Ruleset Caching

```typescript
import { CachedRulesetManager } from '@novai/rulesets';

const cachedManager = new CachedRulesetManager();

// Cache frequently used calculations
const statCheck = await cachedManager.getStatCheck('dnd-5e', 'strength', 15);

// Subsequent calls use cached results
const cachedCheck = await cachedManager.getStatCheck('dnd-5e', 'strength', 15);
```

### Compiled Rulesets

```typescript
import { CompiledRuleset } from '@novai/rulesets';

// Pre-compile rulesets for better performance
const compiledRuleset = new CompiledRuleset(fantasyConfig);

// Compiled rulesets are faster to use
const check = compiledRuleset.getStatCheck('strength', 15);
```

## Testing

### Unit Tests

```typescript
import { DND5eRuleset, Ruleset } from '@novai/rulesets';

describe('Rulesets', () => {
  it('should calculate stat checks correctly', () => {
    const dndRuleset = new DND5eRuleset();
    
    const check = dndRuleset.getStatCheck('strength', 15);
    expect(check.die).toBe(20);
    expect(check.difficulty).toBe(15);
  });

  it('should validate custom rulesets', () => {
    const customRuleset = new Ruleset(customConfig);
    
    const isValid = customRuleset.validate();
    expect(isValid).toBe(true);
  });
});
```

### Integration Tests

```typescript
describe('Ruleset Integration', () => {
  it('should handle complex combat scenarios', () => {
    const ruleset = new DND5eRuleset();
    
    const character = {
      stats: { strength: 16, dexterity: 14 },
      equipment: ['longsword', 'chain_mail'],
      conditions: ['blessed']
    };
    
    const attack = ruleset.getAttackAction(character, 'longsword');
    expect(attack.advantage).toBe(true); // Due to blessed condition
    expect(attack.damage.die).toBe(8); // Longsword damage
  });
});
```

## API Reference

### Ruleset

#### Constructor

```typescript
constructor(config: RulesetConfig)
```

#### Methods

```typescript
getStatCheck(stat: string, difficulty: number): StatCheck
getCombatRules(): CombatRules
getSkillCheck(skill: string, difficulty: number): SkillCheck
validateAction(action: string, context: GameContext): boolean
```

### DND5eRuleset

#### Methods

```typescript
getStatCheck(stat: string, difficulty: number): DNDStatCheck
getCombatRules(): DNDCombatRules
getSpellRules(): SpellRules
getLevelingRules(): LevelingRules
```

### RulesetManager

#### Constructor

```typescript
constructor()
```

#### Methods

```typescript
registerRuleset(ruleset: Ruleset): void
getRuleset(name: string): Ruleset | null
listRulesets(): string[]
validateRuleset(ruleset: Ruleset): ValidationResult
```

## Contributing

1. Fork the repository
2. Create a feature branch
3. Add your ruleset definitions
4. Include tests for new rulesets
5. Submit a pull request

## License

MIT License - see LICENSE file for details. 